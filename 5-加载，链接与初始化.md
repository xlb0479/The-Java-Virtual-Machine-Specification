# 5 加载，链接与初始化

JVM会动态加载、链接、初始化类和接口。加载就是找到指定名字的类或接口类型的二进制表达，然后
根据二进制表达*创建*这个接口或类。链接就是把一个类或接口并入JVM的运行时状态，这样才能够执行。类或接口的初始化包含了类或接口的初始化方法`<clinit>`（§2.9.2）的执行。

在本章中，（嘿嘿，终于弄完了第四章）§5.1讲的是JVM如何从类或接口的二进制表达中获取符号引用。§5.2讲的是JVM是如何启动加载、链接以及初始化过程的。§5.3给出类和接口的二进制表达是如何被类加载器加载以及类和接口是如何被创建的。§5.4讲链接。§5.5会详细说说类和接口的初始化。§5.6介绍本地方法的绑定。最后，§5.7会说一下JVM是什么时候退出的。

## 5.1 运行时常量池

JVM为每个类和接口维护了一个运行时常量池（§2.5.5）。这个数据结构为常见编程语言的符号表提供了大量支持。类或接口的二进制表达中的`constant_pool`表（§4.4）用来在类或接口创建时构造运行时常量池（§5.3）。

在运行时常量池中一共有两种记录：符号引用，后期会做解析（§5.4.3），以及静态常量，不需要进一步处理。

运行时常量池中的符号引用来自于`constant_pool`表中的记录，跟里面的结构一致：

- 对类或接口的符号引用来自于`CONSTANT_Class_info`结构体（§4.4.1）。这种引用按照下面的形式给出类或接口䣌名字：
    - 对于非数组类或接口，名字就是类或接口的二进制名（§4.2.1）。
    - 对于*n*维数组类，名字开头是*n*个ASCII字符`[`，然后是它的元素类型：
        - 如果元素类型是基本类型，则用对应的字段描述符（§4.3.2）表达。
        - 否则，如果元素类型是引用类型，则用ASCII字符`L`开头，然后是元素类型的二进制名，然后跟一个ASCII字符`;`。

&emsp;&emsp;本章中提到类或接口的名字时，都应该理解为上面说的这种格式。（这也是`Class.getName`方法返回的格式。）

- 对类或接口字段的符号引用来自于`CONSTANT_Fieldref_info`结构体（§4.4.2）。这种引用给出了字段的名字和描述符，以及该字段所属的类或接口的符号引用。
- 