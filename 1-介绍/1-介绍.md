# 1 介绍

## 1.1 一点历史

Java语言是一门多用途，支持并发，且面向对象的语言。它语法跟C和C++差不多，但去掉了很多复杂的、难以理解的、不安全的特性。Java平台最初是为了支持网络设备软件开发的。从设计角度出发，用于支持多种主机架构，允许安全地交付软件组件。要实现这些需求，编译后的代码要能够通过网络进行传输，运行在各类客户端上，并且确定客户端可以安全地运行软件。

万维网的普及让上面这些特性更加引人注目。有了浏览器，成千上万的人就可以网上冲浪，访问富媒体内容。最终就形成一种媒介，你所看到的听到的，不管你是用啥机器，网快不快，本质上都是一样的。

网友们很快发现，HTML能体现的内容还是太有限了。虽说没有哪个浏览器能满足用户的所有需求，但HTML扩展，比如表单，让这些限制更加明显。扩展性就是解救之道。

HotJava浏览器起初把Java语言及其平台的这些有意思的特性就展现出来了，它能把程序嵌入到HTML页面中。程序可以随着HTML页面的显示，无感知地下载到浏览器中。在浏览器接纳之前，程序会仔细的检查一下，看看一切是否安全。与HTML页面类似，已编译的程序与网络和宿主机无关。程序的行为始终保持一致，不管它是打哪来的，不管是被加载到什么样的机器上。

浏览器和Java平台的结合，不再局限于起初定义的那一组能力。必须要保证访问带有动态内容的Web页面不会损害到用户的机器。程序员只需要写一套代码，然后它就可以运行在任何支持Java运行时环境的机器上了。

## 1.2 Java虚拟机

Java虚拟机是Java平台的基石。它要负责整个技术体系的硬件与操作系统无关性，编译后代码的体积压缩，还要保护用户免受恶意程序危害。

JVM第一版原型是Sun公司搞的，他们在类似当时PDA的手持设备的软件中模拟JVM指令集。Oracle现在对JVM的实现是在手机、桌面和服务器设备上模拟JVM，但JVM并不假定任何的特定技术、主机硬件或操作系统。它并没有固定的解释，但是可以将它的指令集编译成硅CPU的指令集来实现。它还可以用微码（microcode）或直接用硅来实现。

JVM并不了解Java语言，只认识它的二进制格式，也就是class文件。一个class文件包含了JVM指令（或*字节码*）以及一个符号表，还有一些其他的辅助信息。

出于安全考虑，JVM对class文件中的代码施加强语法和结构约束。但只要你的语言功能可以表达成一个有效的class文件，那就能用JVM来跑。由于它这种用途广且独立于机器的特性，其他语言的实现者就可以把JVM当作一个他们语言的交付设备。

本书介绍的JVM规范兼容Java SE 17，支持*Java语言规范，Java SE 17*中介绍的Java语言。

## 1.3 内容结构

第2章概要介绍JVM架构。

第3章讲的是从Java代码到JVM指令集的编译。

第4章讲class文件格式，它是与硬件和操作系统无关的二进制格式，用来表达编译后的类和接口。

第5章讲JVM的启动，类和接口的加载、链接以及初始化。

第6章介绍JVM的指令集，按照指令的操作码（opcode）助记符的字母顺序来介绍。

第7章给出了JVM操作码助记符表格，已操作码值为索引进行查询。

在*JVM规范*的第二版中，其中的第2章介绍了支持JVM规范的Java语言，但它本身并不属于规范的一部分。在*Java虚拟机规范，Java SE 17*中，如果有Java语言相关的东西，读者会被指引到*Java语言规范，Java SE 17*。指引格式为(JLS §x.y)。

在*JVM规范*的第二版中，其中的第8章详细介绍了JVM线程与共享主存之间的底层交互。在*Java虚拟机规范，Java SE 17*中，关于线程和锁的知识，读者会被指引到*Java语言规范，Java SE 17*的第17章。第17章涵盖了JSR133专家组提出的*Java内存模型与线程规范*。

## 1.4 各种标记

本书中贯穿着各种来自Java SE API的类和接口。当我们仅用一个*N*标识符来引用一个类或者接口（不是那种在栗子中现定义的）时，那就是在引用java.lang包中名为*N*的类或者接口。除了java.lang包以外，我们都会用类或接口的全限定名来做引用。

当我们引用java或其子包中的类或接口的时候，也就是引用了bootstrap类加载器（§5.3.1）所加载的类或接口。

当我们引用java包的子包时，也就是引用bootstrap类加载器所决定的子包。

本书字体规范如下：

- `定宽字体`用来标识JVM的数据类型、异常、错误、class文件结构、Prolog代码以及Java代码片段。
- *斜体*用在JVM“汇编语言”，它的opcode以及操作数，以及JVM运行时数据区里面的玩意。还用于引入新名词，或者用来简单的强调一下。

非规范的内容，用于表明规范含义，则用小号的扩展文本来展示。

<pre>这里是非规范内容。放点儿直观的东西，理性的东西，建议，栗子等。</pre>

## 1.5 问题反馈

欢迎读者们到`jls-jvms-spec-comments@openjdk.java.net`反馈*JVM规范*中的技术性问题。

对于`javac`（Java语言所用的编译器）生成的`class`文件及其操作有问题的话，可以发送到`compiler-dev@openjdk.java.net`。