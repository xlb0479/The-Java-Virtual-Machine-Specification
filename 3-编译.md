# 3 编译

JVM被设计用来支持Java编程语言。Oracle的JDK包含了一个从Java语言到JVM指令集的编译器，以及一个运行时系统，实现了JVM。理解编译器如何利用JVM，对于后来的编译器开发者，以及那些想要了解JVM本身的人们，是很有用的。本章中的编号章节并非规范性内容。

注意，术语“编译器”有的时候指的是从JVM指令集到特定CPU指令集的翻译器。这种翻译器之一就是即时（JIT）代码生成器，它在JVM代码被加载后生成平台相关的指令。本章并不涉及这种代码生成相关的内容，只介绍从Java语言源码到JVM指令的编译。

## 3.1 栗子格式

本章包含了大量的源代码示例，以及加了注释的JVM代码，这些JVM代码是由1.0.2版本Oracle JDK编译器生成的。这些JVM代码使用“虚拟机汇编语言”，由Oracle的`javap`工具生成，这是JDK发行版自带的工具。你自己用`javap`也能生成其它的栗子。

如果你读过汇编语言代码，那这些栗子的格式你应该会很熟悉。每条指令都是这种格式：
```
<index> <opcode> [ <operand1> [ <operand2>... ]] [<comment>]
```

`<index>`是该指令操作码在对应方法的JVM字节码数组中的索引。也可以把它认为是在该方法中的一个字节偏移量。`<opcode>`是指令操作码的助记符号，然后是零或多个`<operandN>`代表指令的操作数。`<comment>`则是放在末尾的注释内容：
```
8 bipush 100 // Push int constant 100
```

注释里面有些东西是`javap`生成的；其它的则是作者加的。每条指令前的`<index>`可能会被用作控制转移指令的目标。比如一个*goto 8*指令就可以将控制转移到索引8对应的指令上。注意，JVM控制转移指令真正的操作数实际上是对应指令操作码的地址偏移量；